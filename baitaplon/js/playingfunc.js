// --- DANH SÁCH BÀI HÁT VÀ BIẾN ĐIỀU KHIỂN ---
const playlist = [
  {
    name: "Nơi Này Có Anh",
    artist: "Sơn Tùng M-TP",
    img: "../img/noinaycoanh.jpg",
    src: "../mp3/nnca.mp3",
    lyrics: `Em là ai từ đâu bước đến nơi đây dịu dàng chân phương (dịu dàng chân phương)
Em là ai tựa như ánh nắng ban mai ngọt ngào trong sương (ngọt ngào trong sương)
Ngắm em thật lâu, con tim anh yếu mềm
Đắm say từ phút đó, từng giây trôi yêu thêm
Bao ngày qua bình minh đánh thức xua tan bộn bề nơi anh (bộn bề nơi anh)
Bao ngày qua niềm thương nỗi nhớ bay theo bầu trời trong xanh (bầu trời trong xanh)
Liếc đôi hàng mi mong manh, anh thẫn thờ
Muốn hôn nhẹ mái tóc, bờ môi em, anh mơ
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Gió mang câu tình ca, ngàn ánh sao vụt qua, nhẹ ôm lấy em
(Yêu em, thương em, con tim anh chân thành)
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Khép đôi mi thật lâu
Nguyện mãi bên cạnh nhau, yêu say đắm như ngày đầu
Mùa xuân đến bình yên, cho anh những giấc mơ
Hạ lưu giữ ngày mưa, ngọt ngào nên thơ
Mùa thu lá vàng rơi, đông sang, anh nhớ em
Tình yêu bé nhỏ xin dành tặng riêng em
(Yeah)
Còn đó tiếng nói ấy bên tai vấn vương bao ngày qua
Ánh mắt bối rối nhớ thương bao ngày qua
Yêu em anh thẫn thờ, con tim bâng khuâng đâu có ngờ
Chẳng bao giờ phải mong chờ, đợi ai trong chiều hoàng hôn mờ
Đắm chìm hòa vào vần thơ, ngắm nhìn khờ dại mộng mơ
Đừng bước vội vàng rồi làm ngơ, lạnh lùng đó làm bộ dạng thờ ơ
Nhìn anh đi em nha, hướng nụ cười cho riêng anh nha
Đơn giản là yêu, con tim anh lên tiếng thôi
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Gió mang câu tình ca, ngàn ánh sao vụt qua, nhẹ ôm lấy em
(Yêu em, thương em, con tim anh chân thành)
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Khép đôi mi thật lâu
Nguyện mãi bên cạnh nhau, yêu say đắm như ngày đầu
Mùa xuân đến bình yên, cho anh những giấc mơ
Hạ lưu giữ ngày mưa, ngọt ngào nên thơ
Mùa thu lá vàng rơi, đông sang, anh nhớ em
Tình yêu bé nhỏ xin dành tặng riêng em
Ah-ah-oh-oh-oh-oh-oh-oh-oh, nhớ thương em
Oh-oh-oh-oh-oh-oh-oh-oh-oh, nhớ thương em lắm
Ah, phía sau chân trời
Có ai băng qua lối về, cùng em đi trên đoạn đường dài
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Gió mang câu tình ca, ngàn ánh sao vụt qua, nhẹ ôm lấy em
(Yêu em, thương em, con tim anh chân thành)
Cầm tay anh (anh), dựa vai anh (anh)
Kề bên anh, nơi này có anh
Khép đôi mi thật lâu
Nguyện mãi bên cạnh nhau, yêu say đắm như ngày đầu (oh-oh)
Mùa xuân đến bình yên, cho anh những giấc mơ
Hạ lưu giữ ngày mưa, ngọt ngào nên thơ
Mùa thu lá vàng rơi, đông sang, anh nhớ em
Tình yêu bé nhỏ xin dành tặng riêng em`,
  },
  {
    name: "Một Năm Mới Bình An",
    artist: "Sơn Tùng M-TP",
    img: "../img/motnammoibinhan.jpg",
    src: "../mp3/mnmba.mp3",
    lyrics: `Xuân mang tình yêu muôn nhà
Mang lời ca chan hoà
Yêu thương hạnh phúc sum vầy
Tết năm nay, nồng ấm đong đầy
Mưa rơi dịu êm gió mang hương về
Dập dìu trông cánh chim xa vời
Từng nhịp giây qua, con tim sao bồi hồi
Xuân sang cành lá đâm chồi
Bao buồn vui qua rồi
Đưa con về với yên bình
Với gia đình nặng nghĩa ân tình
Cây mai đào khoe sắc hoa thêm màu
Nhẹ nhàng trong nắng xuân tươi hồng
Về nhà nhanh thôi
Ba mẹ đang ngóng trông
Bạn bè vui khoe áo mới, xuân tới, phơi phới
Những bao lì xì ngay ngắn, may mắn, tươi tắn
Bánh chưng thơm lừng ngất ngây xuân về ngập tràn lộc muôn nơi
Nắng ban mai hé môi cười, dịu dàng xuân đến
Eh-oh-oh-oh-oh
Có chú chim non mừng vui hót sau nhà
Eh-oh-oh-oh-oh
Có tiếng em thơ mừng vui bóc bao quà
Eh-oh-oh-oh-oh
Có gió mang xuân mừng vui chúc ông bà
Cười mãi thôi
Một năm mới bình an
Năm mới bình an
Okay
Về nhà với mẹ với ba
Quanh bếp hồng ấm áp vui hát ca
Nắng mai rộn ràng e ấp thướt tha
Pháo hoa báo hiệu một năm cũ đã qua
Năm mới sang chứa đựng bao hy vọng bình yên về muôn nhà
Tết đoàn viên sum vầy sẻ chia từng món quà
Rộn ràng mừng ngày xuân, hoà nhịp cùng ngày xuân
Nào cùng dang tay hoà vào mây mừng tết nay mùa xuân tới
Xuân sang cành lá đâm chồi
Bao buồn vui qua rồi
Đưa con về với yên bình
Với gia đình nặng nghĩa ân tình
Cây mai đào khoe sắc hoa thêm màu
Nhẹ nhàng trong nắng xuân tươi hồng
Về nhà nhanh thôi
Ba mẹ đang ngóng trông
Bạn bè vui khoe áo mới, xuân tới, phơi phới
Những bao lì xì ngay ngắn, may mắn, tươi tắn
Bánh chưng thơm lừng ngất ngây xuân về ngập tràn lộc muôn nơi
Nắng ban mai hé môi cười, dịu dàng xuân đến
Eh-oh-oh-oh-oh
Có chú chim non mừng vui hót sau nhà
Eh-oh-oh-oh-oh
Có tiếng em thơ mừng vui bóc bao quà
Eh-oh-oh-oh-oh
Có gió mang xuân mừng vui chúc ông bà
Cười mãi thôi, một năm mới bình an
Một năm mới bình an
Năm mới bình an
Nào cùng dang tay hoà vào mây mừng tết nay mùa xuân tới
Mừng tết sum vầy, nụ cười mãi đong đầy
Mừng tết năm này, rộn ràng pháo giao thừa
Mừng tết sum vầy, nụ cười mãi đong đầy
Eh-oh-oh-oh-oh
Có chú chim non mừng vui hót sau nhà
Eh-oh-oh-oh-oh
Có tiếng em thơ mừng vui bóc bao quà
Eh-oh-oh-oh-oh
Có gió mang xuân mừng vui chúc ông bà
Cười mãi thôi, một năm mới bình an`,
  },
  {
    name: "Có Chắc Yêu Là Đây",
    artist: "Sơn Tùng M-TP",
    img: "../img/cochacyeuladay.jpg",
    src: "../mp3/ccyld.mp3",
    lyrics: `(Thấp thoáng ánh mắt, thấp thoáng ánh mắt)
(Thấp thoáng ánh mắt, thấp thoáng ánh mắt)
Good boy
Thấp thoáng ánh mắt đôi môi mang theo hương mê say
Em cho anh tan trong miên man quên luôn đi đêm ngày
Chạm nhẹ vội vàng hai ba giây nhưng con tim đâu hay
Bối rối khẽ lên ngôi yêu thương đong đầy thật đầy
Anh ngẩn ngơ cứ ngỡ
(Đó chỉ là giấc mơ)
Anh ngẩn ngơ cứ ngỡ
(Như đang ngất ngây trong giấc mơ)
Thật ngọt ngào êm dịu đắm chìm
Phút chốc viết tương tư gieo nên thơ (yeah, hey)
Có câu ca trong gió hát ngân nga, ru trời mây
Nhẹ nhàng đón ban mai ngang qua trao nụ cười (trao nụ cười)
Nắng đua chen, khoe sắc, vui đùa giữa muôn ngàn hoa
Dịu dàng đến nhân gian âu yếm tâm hồn người
Hình như chính em
(Cho anh mong chờ)
Hình như chính là em
(Cho anh vấn vương)
Đừng thờ ơ, xin hãy lắng nghe
Và giúp anh trả lời đôi điều còn băn khoăn
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Em lang thang cả ngày trong tâm trí
Đi không ngừng cả ngày trong tâm trí
Si mê thêm cuồng quay
Oo-ooh, oo-oo-oo-ooh
(Có chắc yêu là đây)
Chắc gì nữa mà chắc
Sáng thì nhớ đêm trắng tương tư còn không phải yêu là gì
(Có chắc yêu là đây)
Rồi thắc gì nữa mà mắc
Đến bên nắm tay nói ra ngay ngồi mơ mộng thêm làm gì
Nhanh chân chạy mua một bó hoa (hey)
Thêm luôn một món quà (hooh)
Khuôn mặt tươi cười lên vô tư gạt đi lo âu mạnh mẽ nha
Và rồi bước ra, bước ra, bước ra (hey)
Có câu ca trong gió hát ngân nga, ru trời mây
Nhẹ nhàng đón ban mai ngang qua trao nụ cười (trao nụ cười)
Nắng đua chen, khoe sắc, vui đùa giữa muôn ngàn hoa
Dịu dàng đến nhân gian âu yếm tâm hồn người
Hình như chính em
(Cho anh mong chờ)
Hình như chính là em
(Cho anh vấn vương)
Đừng thờ ơ, xin hãy lắng nghe
Và giúp anh trả lời đôi điều còn băn khoăn
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Em lang thang cả ngày trong tâm trí
Đi không ngừng cả ngày trong tâm trí
Si mê thêm cuồng quay
Oo-ooh, oo-oo-oo-ooh
Có chắc yêu là đây (a-ah, a-ah)
Có chắc yêu là đây (ooh-ooh, oo-ooh)
Có chắc yêu là đây (a-ah)
Please come to me! (Please come to me!)
Please come to me!
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Có chắc yêu là đây, đây, đây
Có chắc yêu là đây, đây
Em lang thang cả ngày trong tâm trí
Đi không ngừng cả ngày trong tâm trí
Si mê thêm cuồng quay
Oo-ooh, oo-oo-oo-ooh
(Có chắc yêu là đây, đây, đây) M-TP
(Có chắc yêu là đây, đây) Một bài hát
Dành đến cho tất cả những ai đang yêu (có chắc yêu là đây, đây, đây)
Chưa yêu, và sẽ được yêu (có chắc yêu là đây, đây)
Hạnh phúc nhá!`,
  },
];

let currentSongIndex = 0;
let isPlaying = false;

// --- DOM ELEMENTS ---
const audioPlayer = document.getElementById("audio-player");
const currentSongTitle = document.getElementById("current-song");
const songNameDisplay = document.getElementById("song-name");
const artistDisplay = document.getElementById("artist");
const albumArt = document.querySelector(".album-art");
const progressBar = document.getElementById("progress-bar");
const currentTimeDisplay = document.getElementById("current-time");
const durationDisplay = document.getElementById("duration");
const playPauseButton = document.getElementById("btn1-control");
const playPauseText = document.getElementById("play-pause-text");
const btnPrev = document.getElementById("btn-prev");
const btnNext = document.getElementById("btn-next");
const visualizerBars = document.querySelectorAll("#visualizer .bar");
const songLyricsDisplay = document.getElementById("song-lyrics");
// --- CHỨC NĂNG HỖ TRỢ ---

// Chuyển đổi giây thành định dạng MM:SS
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = Math.floor(seconds % 60);
  const formattedSeconds = String(remainingSeconds).padStart(2, "0");
  return `${minutes}:${formattedSeconds}`;
}

// Cập nhật giao diện (tên bài, ảnh) và Tải bài hát
// Cập nhật giao diện (tên bài, ảnh) và Tải bài hát
function loadSong(songIndex) {
  const song = playlist[songIndex];
  audioPlayer.src = song.src;
  currentSongTitle.textContent = song.name;
  songNameDisplay.textContent = song.name;
  artistDisplay.textContent = song.artist;
  albumArt.style.backgroundImage = `url('${song.img}')`;

  // THÊM DÒNG CẬP NHẬT LYRIC NÀY:
  songLyricsDisplay.innerHTML = song.lyrics.replace(/\n/g, "<br>"); // Thay thế ký tự xuống dòng bằng thẻ <br>

  currentSongIndex = songIndex;

  // Reset rating
  document.querySelectorAll(".star").forEach((star) => {
    star.classList.remove("selected");
  });
  // Tải lại audio để cập nhật thời lượng (load)
  audioPlayer.load();
}

// Chức năng Phát nhạc
function playSong() {
  isPlaying = true;
  playPauseText.textContent = "PAUSE";
  audioPlayer.play();
  albumArt.style.animationPlayState = "running";

  // BẬT VISUALIZER
  visualizerBars.forEach((bar) => {
    bar.style.animationPlayState = "running";
  });
}

// Chức năng Dừng nhạc
function pauseSong() {
  isPlaying = false;
  playPauseText.textContent = "PLAY";
  audioPlayer.pause();
  albumArt.style.animationPlayState = "paused";

  // DỪNG VISUALIZER
  visualizerBars.forEach((bar) => {
    bar.style.animationPlayState = "paused";
  });
}

// --- XỬ LÝ SỰ KIỆN NÚT ---

playPauseButton.addEventListener("click", () => {
  isPlaying ? pauseSong() : playSong();
});

btnNext.addEventListener("click", () => {
  currentSongIndex = (currentSongIndex + 1) % playlist.length;
  loadSong(currentSongIndex);
  playSong();
});

btnPrev.addEventListener("click", () => {
  currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
  loadSong(currentSongIndex);
  playSong();
});

// Chức năng chọn bài hát từ playlist
window.selectSong = function (songName) {
  const index = playlist.findIndex((song) => song.name === songName);
  if (index !== -1) {
    loadSong(index);
    playSong();
  }
};

// --- XỬ LÝ SỰ KIỆN AUDIO VÀ PROGRESS BAR ---

// Cập nhật tổng thời lượng khi audio được tải
audioPlayer.addEventListener("loadedmetadata", () => {
  durationDisplay.textContent = formatTime(audioPlayer.duration);
  progressBar.max = audioPlayer.duration;
});

// Cập nhật thanh progress và thời gian hiện tại
audioPlayer.addEventListener("timeupdate", () => {
  const currentTime = audioPlayer.currentTime;
  progressBar.value = currentTime;
  currentTimeDisplay.textContent = formatTime(currentTime);
});

// Tua nhạc
progressBar.addEventListener("change", () => {
  audioPlayer.currentTime = progressBar.value;
  // Giữ trạng thái chơi nhạc nếu đang chơi
  if (isPlaying) {
    audioPlayer.play();
  }
});

// Tự động chuyển bài khi kết thúc
audioPlayer.addEventListener("ended", () => {
  btnNext.click(); // Sử dụng logic của nút Next
});

// Đánh giá sao (giữ nguyên logic cũ)
window.rate = function (stars) {
  const starElements = document.querySelectorAll(".star");
  starElements.forEach((star, index) => {
    if (index < stars) {
      star.classList.add("selected");
    } else {
      star.classList.remove("selected");
    }
  });
};

// --- KHỞI TẠO ---
loadSong(currentSongIndex);
// Đảm bảo Visualizer luôn ở trạng thái paused khi load trang
pauseSong();

// Logic xử lý Responsive Navbar cho Mobile
const menuToggle = document.getElementById("menu-toggle");
const navLinks = document.getElementById("nav-links");
const searchIconMobile = document.getElementById("search-icon-mobile");
const searchBox = document.getElementById("search-box");

if (menuToggle && navLinks) {
  menuToggle.addEventListener("click", function () {
    navLinks.classList.toggle("active");
    if (searchBox.classList.contains("active")) {
      searchBox.classList.remove("active");
    }
  });
}

if (searchIconMobile && searchBox) {
  searchIconMobile.addEventListener("click", function () {
    searchBox.classList.toggle("active");
    if (navLinks.classList.contains("active")) {
      navLinks.classList.remove("active");
    }
  });
}
